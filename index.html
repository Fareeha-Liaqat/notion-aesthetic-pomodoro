<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Lumi Pomodoro</title>
<link rel="icon" href="./logo.png">

<style>
*{box-sizing:border-box;font-family:Inter,system-ui}
body{
margin:0;height:100vh;display:flex;align-items:center;justify-content:center;
background:#111;color:#fff;overflow:hidden;transition:background 0.3s
}

.app{
width:820px;height:420px;background:rgba(0,0,0,0.55);
border-radius:22px;backdrop-filter:blur(18px);
display:flex;padding:20px;gap:20px;position:relative;overflow:hidden
}

.left{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}

.timer{font-size:68px;font-weight:700;margin-bottom:18px;text-shadow:0 0 18px rgba(0,0,0,.6)}

.row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:10px}

button{
border:none;padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:600;
background:rgba(255,255,255,0.12);color:#fff;backdrop-filter:blur(6px);transition:.2s
}
button:hover{background:rgba(255,255,255,0.25)}
button.stopActive{background:#666}

.session{position:absolute;bottom:8px;left:12px;font-size:12px;opacity:.7}

.panel{
width:260px;height:100%;background:rgba(255,255,255,0.05);
border-radius:18px;padding:16px;display:none;flex-direction:column
}
.panel.show{display:flex}

.panelScroll{overflow-y:auto;padding-right:6px}
.field{margin-bottom:18px}
label{font-size:12px;opacity:.8}

input[type="number"],input[type="range"]{
width:100%;margin-top:6px;padding:9px;border-radius:10px;border:none;
background:rgba(255,255,255,0.12);color:#fff
}

.fileBtn{
margin-top:8px;padding:10px;border-radius:12px;background:rgba(255,255,255,0.14);
font-size:12px;cursor:pointer;display:block;text-align:center
}

.fileName{
font-size:11px;opacity:.7;margin-top:6px;word-break:break-all
}

.toggle{position:absolute;top:12px;right:14px;font-size:12px;padding:6px 10px;border-radius:10px}
</style>
</head>

<body>

<div class="app">

<div class="left">
<div class="timer" id="timer">25:00</div>

<div class="row">
<button onclick="startTimer()">Start</button>
<button onclick="pauseTimer()">Pause</button>
<button onclick="resumeTimer()">Resume</button>
<button onclick="resetTimer()">Reset</button>
</div>

<div class="row">
<button onclick="startBreak()">Break</button>
<button id="stopSound" onclick="stopSound()">Stop Sound</button>
<button onclick="resetSessions()">Reset Session</button>
</div>

<div class="session" id="session">Sessions: 0</div>
</div>

<!-- PANEL -->
<div class="panel" id="panel">
<div class="panelScroll">

<div class="field">
<label>Custom Minutes</label>
<input id="customTime" type="number" value="25">
</div>

<div class="field">
<label>Background</label>
<label class="fileBtn">
Upload / Replace background
<input type="file" id="bgInput" hidden>
</label>
<div id="bgName" class="fileName"></div>
</div>

<div class="field">
<label>Alarm Sound</label>
<label class="fileBtn">
Upload / Replace sound
<input type="file" id="audioInput" hidden>
</label>
<div id="audioName" class="fileName"></div>
</div>

<div class="field">
<label>Zoom</label>
<input type="range" id="zoom" min="0.5" max="2" step="0.01" value="1" disabled>
</div>

<div class="field">
<label>Position X</label>
<input type="range" id="posX" min="-500" max="500" value="0" disabled>
</div>

<div class="field">
<label>Position Y</label>
<input type="range" id="posY" min="-500" max="500" value="0" disabled>
</div>

</div>
</div>

<button class="toggle" onclick="togglePanel()">âš™</button>
</div>

<script>
/* DAILY RESET */
const todayKey="lumi_today";
const sessionKey="lumi_sessions";
let sessions=0;

function checkDailyReset(){
const today=new Date().toDateString();
const savedDay=localStorage.getItem(todayKey);

if(savedDay!==today){
localStorage.setItem(todayKey,today);
localStorage.setItem(sessionKey,"0");
sessions=0;
}else{
sessions=parseInt(localStorage.getItem(sessionKey)||"0");
}
document.getElementById("session").innerText="Sessions: "+sessions;
}
checkDailyReset();

/* TIMER */
let time=1500,timer,running=false;
let audio=new Audio();

const timerEl=document.getElementById("timer");

function updateDisplay(){
let m=Math.floor(time/60);
let s=time%60;
let txt=`${m}:${s.toString().padStart(2,'0')}`;
timerEl.innerText=txt;
}

function startTimer(){
if(running)return;
running=true;
panel.classList.remove("show");

timer=setInterval(()=>{
time--;
updateDisplay();

if(time<=0){
clearInterval(timer);
running=false;
sessions++;
localStorage.setItem(sessionKey,sessions);
document.getElementById("session").innerText="Sessions: "+sessions;
audio.play();
}
},1000);
}

function pauseTimer(){clearInterval(timer);running=false}
function resumeTimer(){if(!running)startTimer()}

function resetTimer(){
clearInterval(timer);running=false;
time=(parseInt(customTime.value)||25)*60;
updateDisplay();
audio.pause();audio.currentTime=0;
}

function startBreak(){
clearInterval(timer);running=false;
time=300;
updateDisplay();
startTimer();
audio.pause();audio.currentTime=0;
}

function stopSound(){
audio.pause();audio.currentTime=0;
let btn=document.getElementById("stopSound");
btn.classList.add("stopActive");
setTimeout(()=>btn.classList.remove("stopActive"),3000);
}

function resetSessions(){
sessions=0;
localStorage.setItem(sessionKey,"0");
document.getElementById("session").innerText="Sessions: 0";
}

function togglePanel(){panel.classList.toggle("show")}

/* BACKGROUND */
const bgInput=document.getElementById("bgInput");
const bgName=document.getElementById("bgName");
const zoomEl=document.getElementById("zoom");
const posXEl=document.getElementById("posX");
const posYEl=document.getElementById("posY");

let bgData=localStorage.getItem("lumi_bg");

if(bgData){
applyBG(bgData);
document.getElementById("bgName").textContent = "Background loaded";
zoomEl.disabled=false;
posXEl.disabled=false;
posYEl.disabled=false;
}

bgInput.addEventListener("change",function(){
const file = this.files[0];
if(!file) return;

const reader = new FileReader();
reader.onload = function(e){
    bgData = e.target.result;
    localStorage.setItem("lumi_bg", bgData);
    applyBG(bgData);

    // FORCE filename to show
    document.getElementById("bgName").textContent = file.name;

    zoomEl.disabled = false;
    posXEl.disabled = false;
    posYEl.disabled = false;
};
reader.readAsDataURL(file);

// important: allow re-upload same file later
this.value = "";
});

function applyBG(data){
document.body.style.backgroundImage=`url(${data})`;
updateBG();
}

function updateBG(){
if(!bgData)return;

document.body.style.backgroundSize=`${zoomEl.value*100}%`;
document.body.style.backgroundPosition=
`calc(50% + ${posXEl.value}px) calc(50% + ${posYEl.value}px)`;
}

zoomEl.oninput=updateBG;
posXEl.oninput=updateBG;
posYEl.oninput=updateBG;

/* AUDIO */
const audioInput=document.getElementById("audioInput");
const audioName=document.getElementById("audioName");

audioInput.addEventListener("change",function(){
const file=this.files[0];
if(!file)return;

audio.src=URL.createObjectURL(file);
audioName.textContent=file.name;
this.value="";
});

updateDisplay();
/* LIVE UPDATE when typing custom minutes */
const customTimeInput = document.getElementById("customTime");

customTimeInput.addEventListener("input", () => {
if(running) return; // don't change while timer running
time = (parseInt(customTimeInput.value) || 25) * 60;
updateDisplay();
});

</script>

</body>
</html>

